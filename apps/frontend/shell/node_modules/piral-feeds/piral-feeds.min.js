var piralFeeds=(()=>{var E=Object.create;var m=Object.defineProperty;var K=Object.getOwnPropertyDescriptor;var N=Object.getOwnPropertyNames;var V=Object.getPrototypeOf,_=Object.prototype.hasOwnProperty;var s=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,n)=>(typeof require<"u"?require:e)[n]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});var P=(t,e)=>{for(var n in e)m(t,n,{get:e[n],enumerable:!0})},h=(t,e,n,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of N(e))!_.call(t,r)&&r!==n&&m(t,r,{get:()=>e[r],enumerable:!(o=K(e,r))||o.enumerable});return t};var j=(t,e,n)=>(n=t!=null?E(V(t)):{},h(e||!t||!t.__esModule?m(n,"default",{value:t,enumerable:!0}):n,t)),k=t=>h(m({},"__esModule",{value:!0}),t);var H={};P(H,{createFeedsApi:()=>B,useFeed:()=>D,withFeed:()=>y});var C={};P(C,{createFeed:()=>L,destroyFeed:()=>$,loadFeed:()=>q,loadedFeed:()=>f,updateFeed:()=>b});var c=s("piral-core");function L(t,e){t.dispatch(n=>({...n,feeds:(0,c.withKey)(n.feeds,e,{data:void 0,error:void 0,loaded:!1,loading:!1})}))}function $(t,e){t.dispatch(n=>({...n,feeds:(0,c.withoutKey)(n.feeds,e)}))}function q(t,e){let{id:n}=e;return t.dispatch(o=>({...o,feeds:(0,c.withKey)(o.feeds,n,{data:void 0,error:void 0,loaded:!1,loading:!0})})),e.initialize().then(o=>{f(t,n,o,void 0),e.dispose=e.connect(r=>{b(t,n,r,e.update)})},o=>f(t,n,void 0,o))}function f(t,e,n,o){t.dispatch(r=>({...r,feeds:(0,c.withKey)(r.feeds,e,{loading:!1,loaded:!0,error:o,data:n})}))}function b(t,e,n,o){let r=t.readState(a=>a.feeds[e]),i=o(r.data,n);if(i instanceof Promise)return i.then(a=>f(t,e,a,void 0)).catch(a=>f(t,e,void 0,a));i!==r.data&&f(t,e,i,void 0)}var w=s("piral-core");var F=j(s("react")),T=s("piral-core");var x=s("react"),p=s("piral-core");function D(t){let{loaded:e,loading:n,error:o,data:r}=(0,p.useGlobalState)(a=>a.feeds[t.id]),i=(0,p.useAction)("loadFeed");return(0,x.useEffect)(()=>{!e&&!n&&i(t)},[e]),[e,r,o]}function y(t,e){let n=o=>{let[r,i,a]=D(e);return r?i?F.createElement(t,{...o,data:i}):F.createElement(T.RegisteredErrorInfo,{type:"feed",error:a}):F.createElement(T.RegisteredLoadingIndicator,null)};return n.displayName=`FeedView_${e.id}`,n}var S=s("piral-core"),R=()=>{};function G(t,e){return(0,S.isfunc)(e)?{id:t,initialize(){return e()},connect(){return R},update(n){return Promise.resolve(n)},immediately:!1,reducers:{}}:{id:t,initialize(){return e.initialize()},connect(n){return typeof e.connect=="function"?e.connect(n):R},update(n,o){return typeof e.update=="function"?e.update(n,o):Promise.resolve(n)},immediately:e.immediately,reducers:e.reducers||{}}}function B(t={}){return e=>(e.defineActions(C),e.dispatch(n=>({...n,feeds:{}})),(n,o)=>{let r=0;return{createConnector(i){let a=(0,w.buildName)(o.name,r++),d=G(a,i),g=()=>{d.dispose?.(),e.createFeed(d.id)};d.immediately?e.loadFeed(d):g();let u=l=>y(l,d);return Object.keys(d.reducers).forEach(l=>{let I=d.reducers[l];typeof I=="function"&&(u[l]=(...A)=>{e.updateFeed(a,A,(O,z)=>I.call(u,O,...z))})}),u.invalidate=g,u}}})}return k(H);})();
